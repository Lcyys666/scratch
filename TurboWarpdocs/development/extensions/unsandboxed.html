<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-development/extensions/unsandboxed" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.1.0">
<title data-rh="true">非沙盒化扩展 | TurboWarp 文档</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://docs.turbowarp.org/development/extensions/unsandboxed"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="非沙盒化扩展 | TurboWarp 文档"><meta data-rh="true" name="description" content="非沙盒化扩展作为普通的 `` 标签在主窗口中运行，而不是在沙盒中运行。它们可以访问许多新的功能和责任，我们将在下面讨论。"><meta data-rh="true" property="og:description" content="非沙盒化扩展作为普通的 `` 标签在主窗口中运行，而不是在沙盒中运行。它们可以访问许多新的功能和责任，我们将在下面讨论。"><link data-rh="true" rel="canonical" href="https://docs.turbowarp.org/development/extensions/unsandboxed"><link data-rh="true" rel="alternate" href="https://docs.turbowarp.org/development/extensions/unsandboxed" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.turbowarp.org/development/extensions/unsandboxed" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://HORQ9E5CCA-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="TurboWarp 文档" href="/opensearch.xml"><link rel="stylesheet" href="/assets/css/styles.6e1a49a6.css">
<script src="/assets/js/runtime~main.918eff89.js" defer="defer"></script>
<script src="/assets/js/main.361b228d.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();null!==e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,t("light"))}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><b class="navbar__title text--truncate">TurboWarp 文档</b></a><a class="navbar__item navbar__link" href="/packager">打包器</a><a class="navbar__item navbar__link" href="/development">开发</a></div><div class="navbar__items navbar__items--right"><a href="https://turbowarp.org/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">TurboWarp<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://github.com/TurboWarp" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/development">开发</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/development/extensions/introduction">自定义扩展教程</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/development/extensions/introduction">自定义扩展简介</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/development/extensions/hello-world">Hello, world!</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/development/extensions/inputs">处理输入</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/development/extensions/async">处理非即时操作</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/development/extensions/sandbox">沙盒到底是什么？</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/development/extensions/unsandboxed">非沙盒化扩展</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/development/extensions/better-development-server">更好的开发服务器</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/development/extensions/assorted-apis">各种 API</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/development/extensions/hats">  事件和帽子积木块</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/development/extensions/compatibility">维护兼容性</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/development/extensions/share">分享您的扩展</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/development/extensions/wrapping-up">总结</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/development/getting-started">修改入门</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/development/globals">全局变量</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/development/scratchx">ScratchX 和 TurboWarp</a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col"><div class="docItemContainer_Djhp"><article><div class="theme-doc-markdown markdown"><h1>非沙盒化扩展</h1>
<!-- -->
<!-- -->
<p>非沙盒化扩展作为普通的 <code>&lt;script&gt;</code> 标签在主窗口中运行，而不是在沙盒中运行。它们可以访问许多新的功能和责任，我们将在下面讨论。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="url-限制">URL 限制<a href="#url-限制" class="hash-link" aria-label="Direct link to URL 限制" title="Direct link to URL 限制">​</a></h2>
<p>为了保护用户免受恶意扩展的影响，从 URL 加载的扩展只有在其 URL <em>精确地</em>以以下开头时才会以非沙盒化方式运行：</p>
<ul>
<li><code>https://extensions.turbowarp.org/</code></li>
<li><code>http://localhost:8000/</code></li>
</ul>
<p>由于您无法控制 extensions.turbowarp.org，您将不得不使用后一个选项。为此，请将您的本地 HTTP 服务器配置为在端口 8000 上运行，而不是您迄今为止使用的端口。</p>
<p>当从文件或 JavaScript 源代码手动加载扩展时，有一个选项可以在不使用沙盒的情况下加载扩展。出于安全考虑，使用 URL 时不存在强制扩展以非沙盒化方式运行的选项。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="语法">语法<a href="#语法" class="hash-link" aria-label="Direct link to 语法" title="Direct link to 语法">​</a></h2>
<p>非沙盒化扩展的语法非常熟悉，但有一些不同。从技术上讲，如果您只是将旧的沙盒化扩展复制并粘贴为非沙盒化扩展，它看起来会正常工作。但是，这是危险的，很可能会在以后导致错误。</p>
<p>如果您的沙盒化扩展有这样的代码：</p>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:#008000">// 旧的沙盒化扩展（worker 或 &lt;iframe&gt; 沙盒）：</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:#0000ff">class</span><span class="token plain"> </span><span class="token class-name" style="color:#267f99">MyExtension</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token function" style="color:#795e26">getInfo</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#af00db">return</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token comment" style="color:#008000">/* ... */</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token maybe-class-name">Scratch</span><span class="token punctuation">.</span><span class="token property-access">extensions</span><span class="token punctuation">.</span><span class="token method function property-access" style="color:#795e26">register</span><span class="token punctuation">(</span><span class="token keyword" style="color:#0000ff">new</span><span class="token plain"> </span><span class="token class-name" style="color:#267f99">MyExtension</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>或者如果您的扩展使用旧的&quot;插件&quot;机制，比如这个：（如果您不认识这段代码，那就不用担心）</p>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:#0000ff">class</span><span class="token plain"> </span><span class="token class-name" style="color:#267f99">MyExtension</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token function" style="color:#795e26">getInfo</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#af00db">return</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token comment" style="color:#008000">/* ... */</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation">(</span><span class="token keyword" style="color:#0000ff">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token keyword" style="color:#0000ff">var</span><span class="token plain"> extensionInstance </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:#0000ff">new</span><span class="token plain"> </span><span class="token class-name" style="color:#267f99">MyExtension</span><span class="token punctuation">(</span><span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token property-access">vm</span><span class="token punctuation">.</span><span class="token property-access">extensionManager</span><span class="token punctuation">.</span><span class="token property-access">runtime</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token keyword" style="color:#0000ff">var</span><span class="token plain"> serviceName </span><span class="token operator">=</span><span class="token plain"> </span><span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token property-access">vm</span><span class="token punctuation">.</span><span class="token property-access">extensionManager</span><span class="token punctuation">.</span><span class="token method function property-access" style="color:#795e26">_registerInternalExtension</span><span class="token punctuation">(</span><span class="token plain">extensionInstance</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token property-access">vm</span><span class="token punctuation">.</span><span class="token property-access">extensionManager</span><span class="token punctuation">.</span><span class="token property-access">_loadedExtensions</span><span class="token punctuation">.</span><span class="token method function property-access" style="color:#795e26">set</span><span class="token punctuation">(</span><span class="token plain">extensionInstance</span><span class="token punctuation">.</span><span class="token method function property-access" style="color:#795e26">getInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">,</span><span class="token plain"> serviceName</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>非沙盒化版本的代码应该是这样的：</p>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token punctuation">(</span><span class="token keyword" style="color:#0000ff">function</span><span class="token punctuation">(</span><span class="token parameter maybe-class-name">Scratch</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token string" style="color:#a31515">&#x27;use strict&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token keyword" style="color:#0000ff">class</span><span class="token plain"> </span><span class="token class-name" style="color:#267f99">MyExtension</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token function" style="color:#795e26">getInfo</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token keyword control-flow" style="color:#af00db">return</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token comment" style="color:#008000">/* ... */</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token maybe-class-name">Scratch</span><span class="token punctuation">.</span><span class="token property-access">extensions</span><span class="token punctuation">.</span><span class="token method function property-access" style="color:#795e26">register</span><span class="token punctuation">(</span><span class="token keyword" style="color:#0000ff">new</span><span class="token plain"> </span><span class="token class-name" style="color:#267f99">MyExtension</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token maybe-class-name">Scratch</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>使用这个模板可以防止非沙盒化扩展在尝试定义具有相同名称的变量、类或函数时相互干扰。通过要求所有内容都在<a href="https://developer.mozilla.org/en-US/docs/Glossary/IIFE" target="_blank" rel="noopener noreferrer">立即调用的函数表达式（IIFE）</a>中定义并启用<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Strict_mode" target="_blank" rel="noopener noreferrer">严格模式</a>，我们可以防止变量意外泄漏到全局作用域。</p>
<p>扩展定义的<em>所有</em>函数和变量都必须在 IIFE 内定义。此外，每个扩展必须确保使用自己的 <code>Scratch</code> API 副本，这个模板会自动完成这一点。</p>
<p>关于这个模板的一个有趣之处是它与沙盒化扩展向后兼容。只要扩展不使用任何给予非沙盒化扩展的功能，它就会继续像沙盒化扩展一样工作。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="一个更完整的示例">一个更完整的示例<a href="#一个更完整的示例" class="hash-link" aria-label="Direct link to 一个更完整的示例" title="Direct link to 一个更完整的示例">​</a></h2>
<p>这里您可以看到一个完整的非沙盒化扩展：</p>
<div><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockTitle_Ktv7"><div>unsandboxed/hello-world-unsandboxed.js<!-- --> - <a target="_blank" rel="noopener noreferrer" href="https://turbowarp.org/editor?extension=https://extensions.turbowarp.org/docs-examples/unsandboxed/hello-world-unsandboxed.js">Try this extension</a></div></div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm"><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token punctuation">(</span><span class="token keyword" style="color:#0000ff">function</span><span class="token punctuation">(</span><span class="token parameter maybe-class-name">Scratch</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span><span class="token string" style="color:#a31515">&#x27;use strict&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#af00db">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token maybe-class-name">Scratch</span><span class="token punctuation">.</span><span class="token property-access">extensions</span><span class="token punctuation">.</span><span class="token property-access">unsandboxed</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#af00db">throw</span><span class="token plain"> </span><span class="token keyword" style="color:#0000ff">new</span><span class="token plain"> </span><span class="token class-name" style="color:#267f99">Error</span><span class="token punctuation">(</span><span class="token string" style="color:#a31515">&#x27;This Hello World example must run unsandboxed&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span><span class="token keyword" style="color:#0000ff">class</span><span class="token plain"> </span><span class="token class-name" style="color:#267f99">HelloWorld</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token function" style="color:#795e26">getInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">      </span><span class="token keyword control-flow" style="color:#af00db">return</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token literal-property property">id</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:#a31515">&#x27;helloworldunsandboxed&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token literal-property property">name</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:#a31515">&#x27;Unsandboxed Hello World&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token literal-property property">blocks</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">          </span><span class="token punctuation">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token literal-property property">opcode</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:#a31515">&#x27;hello&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token literal-property property">blockType</span><span class="token operator">:</span><span class="token plain"> </span><span class="token maybe-class-name">Scratch</span><span class="token punctuation">.</span><span class="token property-access maybe-class-name">BlockType</span><span class="token punctuation">.</span><span class="token constant" style="color:#267f99">REPORTER</span><span class="token punctuation">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token literal-property property">text</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:#a31515">&#x27;Hello!&#x27;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">          </span><span class="token punctuation">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token punctuation">]</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token function" style="color:#795e26">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">      </span><span class="token keyword control-flow" style="color:#af00db">return</span><span class="token plain"> </span><span class="token string" style="color:#a31515">&#x27;World!&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span><span class="token maybe-class-name">Scratch</span><span class="token punctuation">.</span><span class="token property-access">extensions</span><span class="token punctuation">.</span><span class="token method function property-access" style="color:#795e26">register</span><span class="token punctuation">(</span><span class="token keyword" style="color:#0000ff">new</span><span class="token plain"> </span><span class="token class-name" style="color:#267f99">HelloWorld</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token maybe-class-name">Scratch</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div>
<p>如果您使用本地 HTTP 服务器，请保存这个文件以便通过服务器访问，然后在 TurboWarp 中加载精确的 URL <a href="http://localhost:8000/hello-world-unsandboxed.js" target="_blank" rel="noopener noreferrer">http://localhost:8000/hello-world-unsandboxed.js</a>。如果没有显示任何内容，请查看开发者控制台。如果您看到扩展必须以非沙盒化方式运行的错误，很可能是您使用的是旧版本的 TurboWarp，或者您没有从精确以 <code>http://localhost:8000/</code> 开头的 URL 加载它。127.0.0.1 和 0.0.0.0 都不行！必须是 localhost，端口必须是 8000。</p>
<p>如果您只是使用文件，请确保每次加载扩展时都勾选&quot;在沙盒外运行扩展&quot;框。</p>
<p>创建一个新的空项目，其中包含一个重复 (30) 循环，将 &quot;hello&quot; 积木块添加到列表中。注意，它现在立即运行，而沙盒化版本至少需要一秒钟。</p>
<p>观察到大部分代码仍然是相同的：您仍然创建一个类，然后调用 Scratch.extensions.register()，然后 Scratch 调用 getInfo() 返回相同类型的对象。只是周围的模板不同。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="更大的权力带来更大的责任">更大的权力带来更大的责任<a href="#更大的权力带来更大的责任" class="hash-link" aria-label="Direct link to 更大的权力带来更大的责任" title="Direct link to 更大的权力带来更大的责任">​</a></h2>
<p>在我们讨论新的 API 之前，我们想指出一些非沙盒化扩展的额外要求：</p>
<ul>
<li>积木块不能抛出错误。虽然沙盒化扩展可以这样做，但这样做的非沙盒化扩展可能会破坏脚本。</li>
<li>输入和布尔积木块必须返回有效值。虽然沙盒化扩展可以忽略这一点，但不返回适当值（字符串、数字或布尔值）的非沙盒化扩展可能会以未知的方式破坏脚本。</li>
<li>积木块不能陷入无限循环。虽然沙盒化扩展如果陷入循环通常不会冻结整个窗口，但非沙盒化扩展会。这可能导致<strong>数据丢失</strong>。</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="访问-scratch-内部功能">访问 Scratch 内部功能<a href="#访问-scratch-内部功能" class="hash-link" aria-label="Direct link to 访问 Scratch 内部功能" title="Direct link to 访问 Scratch 内部功能">​</a></h2>
<p>非沙盒化扩展可以做的最重要的事情是直接访问 Scratch 内部功能。</p>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token keyword" style="color:#0000ff">const</span><span class="token plain"> vm </span><span class="token operator">=</span><span class="token plain"> </span><span class="token maybe-class-name">Scratch</span><span class="token punctuation">.</span><span class="token property-access">vm</span><span class="token punctuation">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>这就是对实际 Scratch VM 对象的完全访问。您可以用它做很多事情。</p>
<p>记住 -- 每个变量声明都必须发生在 IIFE <em>内部</em>。</p>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:#008000">// 好的代码</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation">(</span><span class="token keyword" style="color:#0000ff">function</span><span class="token punctuation">(</span><span class="token parameter maybe-class-name">Scratch</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token keyword" style="color:#0000ff">const</span><span class="token plain"> vm </span><span class="token operator">=</span><span class="token plain"> </span><span class="token maybe-class-name">Scratch</span><span class="token punctuation">.</span><span class="token property-access">vm</span><span class="token punctuation">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token comment" style="color:#008000">// ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token maybe-class-name">Scratch</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:#008000">// 坏的代码</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:#0000ff">const</span><span class="token plain"> vm </span><span class="token operator">=</span><span class="token plain"> </span><span class="token maybe-class-name">Scratch</span><span class="token punctuation">.</span><span class="token property-access">vm</span><span class="token punctuation">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation">(</span><span class="token keyword" style="color:#0000ff">function</span><span class="token punctuation">(</span><span class="token parameter maybe-class-name">Scratch</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token comment" style="color:#008000">// ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token maybe-class-name">Scratch</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>四处查找以找到您要找的内容。当扩展加载后，您可以从开发者工具访问 <code>Scratch</code>，或使用其他可用的<a href="/development/globals">调试全局变量</a>（但请不要在扩展中使用这些），您的开发者工具将非常有用。您可能会发现 <a href="https://github.com/TurboWarp/scratch-vm/" target="_blank" rel="noopener noreferrer">scratch-vm 源代码</a> 或 <a href="https://github.com/turboWarp/types" target="_blank" rel="noopener noreferrer">@turbowarp/types</a> 是有用的资源。</p>
<p>这里是一个使用 Scratch.vm 切换涡轮模式的扩展示例，类似于 <a href="https://extensions.turbowarp.org/" target="_blank" rel="noopener noreferrer">extensions.turbowarp.org</a> 上的 &quot;runtime options&quot; 扩展：</p>
<div><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockTitle_Ktv7"><div>unsandboxed/turbo-mode.js<!-- --> - <a target="_blank" rel="noopener noreferrer" href="https://turbowarp.org/editor?extension=https://extensions.turbowarp.org/docs-examples/unsandboxed/turbo-mode.js">Try this extension</a></div></div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm"><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token punctuation">(</span><span class="token keyword" style="color:#0000ff">function</span><span class="token punctuation">(</span><span class="token parameter maybe-class-name">Scratch</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span><span class="token string" style="color:#a31515">&#x27;use strict&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#af00db">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token maybe-class-name">Scratch</span><span class="token punctuation">.</span><span class="token property-access">extensions</span><span class="token punctuation">.</span><span class="token property-access">unsandboxed</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#af00db">throw</span><span class="token plain"> </span><span class="token keyword" style="color:#0000ff">new</span><span class="token plain"> </span><span class="token class-name" style="color:#267f99">Error</span><span class="token punctuation">(</span><span class="token string" style="color:#a31515">&#x27;This Turbo Mode example must run unsandboxed&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span><span class="token keyword" style="color:#0000ff">const</span><span class="token plain"> vm </span><span class="token operator">=</span><span class="token plain"> </span><span class="token maybe-class-name">Scratch</span><span class="token punctuation">.</span><span class="token property-access">vm</span><span class="token punctuation">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span><span class="token keyword" style="color:#0000ff">class</span><span class="token plain"> </span><span class="token class-name" style="color:#267f99">TurboMode</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token function" style="color:#795e26">getInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">      </span><span class="token keyword control-flow" style="color:#af00db">return</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token literal-property property">id</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:#a31515">&#x27;turbomodeunsandboxed&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token literal-property property">name</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:#a31515">&#x27;Turbo Mode&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token literal-property property">blocks</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">          </span><span class="token punctuation">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token literal-property property">opcode</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:#a31515">&#x27;set&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token literal-property property">blockType</span><span class="token operator">:</span><span class="token plain"> </span><span class="token maybe-class-name">Scratch</span><span class="token punctuation">.</span><span class="token property-access maybe-class-name">BlockType</span><span class="token punctuation">.</span><span class="token constant" style="color:#267f99">COMMAND</span><span class="token punctuation">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token literal-property property">text</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:#a31515">&#x27;set turbo mode to [ENABLED]&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token literal-property property">arguments</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">              </span><span class="token constant" style="color:#267f99">ENABLED</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">                </span><span class="token literal-property property">type</span><span class="token operator">:</span><span class="token plain"> </span><span class="token maybe-class-name">Scratch</span><span class="token punctuation">.</span><span class="token property-access maybe-class-name">ArgumentType</span><span class="token punctuation">.</span><span class="token constant" style="color:#267f99">STRING</span><span class="token punctuation">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">                </span><span class="token literal-property property">menu</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:#a31515">&#x27;ENABLED_MENU&#x27;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">              </span><span class="token punctuation">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token punctuation">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">          </span><span class="token punctuation">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token literal-property property">menus</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">          </span><span class="token constant" style="color:#267f99">ENABLED_MENU</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token literal-property property">acceptReporters</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean" style="color:#0000ff">true</span><span class="token punctuation">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token literal-property property">items</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token string" style="color:#a31515">&#x27;on&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string" style="color:#a31515">&#x27;off&#x27;</span><span class="token punctuation">]</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">          </span><span class="token punctuation">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token punctuation">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token function" style="color:#795e26">set</span><span class="token punctuation">(</span><span class="token plain">args</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">      vm</span><span class="token punctuation">.</span><span class="token method function property-access" style="color:#795e26">setTurboMode</span><span class="token punctuation">(</span><span class="token plain">args</span><span class="token punctuation">.</span><span class="token constant" style="color:#267f99">ENABLED</span><span class="token plain"> </span><span class="token operator">===</span><span class="token plain"> </span><span class="token string" style="color:#a31515">&#x27;on&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span><span class="token maybe-class-name">Scratch</span><span class="token punctuation">.</span><span class="token property-access">extensions</span><span class="token punctuation">.</span><span class="token method function property-access" style="color:#795e26">register</span><span class="token punctuation">(</span><span class="token keyword" style="color:#0000ff">new</span><span class="token plain"> </span><span class="token class-name" style="color:#267f99">TurboMode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token maybe-class-name">Scratch</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="积木块工具对象">积木块工具对象<a href="#积木块工具对象" class="hash-link" aria-label="Direct link to 积木块工具对象" title="Direct link to 积木块工具对象">​</a></h2>
<p>当运行沙盒化自定义扩展时，它只接收脚本提供的参数。它甚至不知道是哪个角色在执行它。我们现在介绍传递给积木块函数的第二个参数：BlockUtility。</p>
<p>BlockUtility 对象，通常称为 <code>util</code>，允许非沙盒化扩展中的积木块使用 <code>util.target</code> 直接访问正在运行它们的角色。与 VM 类似，这是内部使用的实际对象。您可以完全访问它。</p>
<p>这里是一个演示如何使用 <code>util.target</code> 获取当前角色名称或访问变量的扩展示例。</p>
<div><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockTitle_Ktv7"><div>unsandboxed/block-utility-examples.js<!-- --> - <a target="_blank" rel="noopener noreferrer" href="https://turbowarp.org/editor?extension=https://extensions.turbowarp.org/docs-examples/unsandboxed/block-utility-examples.js">Try this extension</a></div></div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm"><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token punctuation">(</span><span class="token keyword" style="color:#0000ff">function</span><span class="token punctuation">(</span><span class="token parameter maybe-class-name">Scratch</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span><span class="token string" style="color:#a31515">&#x27;use strict&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#af00db">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token maybe-class-name">Scratch</span><span class="token punctuation">.</span><span class="token property-access">extensions</span><span class="token punctuation">.</span><span class="token property-access">unsandboxed</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#af00db">throw</span><span class="token plain"> </span><span class="token keyword" style="color:#0000ff">new</span><span class="token plain"> </span><span class="token class-name" style="color:#267f99">Error</span><span class="token punctuation">(</span><span class="token string" style="color:#a31515">&#x27;This Block Utility example must run unsandboxed&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span><span class="token keyword" style="color:#0000ff">class</span><span class="token plain"> </span><span class="token class-name" style="color:#267f99">BlockUtilityExamples</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token function" style="color:#795e26">getInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">      </span><span class="token keyword control-flow" style="color:#af00db">return</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token literal-property property">id</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:#a31515">&#x27;blockutilityexamples&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token literal-property property">name</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:#a31515">&#x27;BlockUtility Examples&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token literal-property property">blocks</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">          </span><span class="token punctuation">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token literal-property property">opcode</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:#a31515">&#x27;getSpriteName&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token literal-property property">text</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:#a31515">&#x27;sprite name&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token literal-property property">blockType</span><span class="token operator">:</span><span class="token plain"> </span><span class="token maybe-class-name">Scratch</span><span class="token punctuation">.</span><span class="token property-access maybe-class-name">BlockType</span><span class="token punctuation">.</span><span class="token constant" style="color:#267f99">REPORTER</span><span class="token punctuation">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">          </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">          </span><span class="token punctuation">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token literal-property property">opcode</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:#a31515">&#x27;doesVariableExist&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token literal-property property">text</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:#a31515">&#x27;is there a [TYPE] named [NAME]?&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token literal-property property">blockType</span><span class="token operator">:</span><span class="token plain"> </span><span class="token maybe-class-name">Scratch</span><span class="token punctuation">.</span><span class="token property-access maybe-class-name">BlockType</span><span class="token punctuation">.</span><span class="token constant" style="color:#267f99">BOOLEAN</span><span class="token punctuation">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token literal-property property">arguments</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">              </span><span class="token constant" style="color:#267f99">NAME</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">                </span><span class="token literal-property property">type</span><span class="token operator">:</span><span class="token plain"> </span><span class="token maybe-class-name">Scratch</span><span class="token punctuation">.</span><span class="token property-access maybe-class-name">ArgumentType</span><span class="token punctuation">.</span><span class="token constant" style="color:#267f99">STRING</span><span class="token punctuation">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">                </span><span class="token literal-property property">defaultValue</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:#a31515">&#x27;my variable&#x27;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">              </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">              </span><span class="token constant" style="color:#267f99">TYPE</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">                </span><span class="token literal-property property">type</span><span class="token operator">:</span><span class="token plain"> </span><span class="token maybe-class-name">Scratch</span><span class="token punctuation">.</span><span class="token property-access maybe-class-name">ArgumentType</span><span class="token punctuation">.</span><span class="token constant" style="color:#267f99">STRING</span><span class="token punctuation">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">                </span><span class="token literal-property property">menu</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:#a31515">&#x27;TYPE_MENU&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">                </span><span class="token literal-property property">defaultValue</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:#a31515">&#x27;list&#x27;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">              </span><span class="token punctuation">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token punctuation">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">          </span><span class="token punctuation">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token literal-property property">menus</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">          </span><span class="token constant" style="color:#267f99">TYPE_MENU</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token literal-property property">acceptReporters</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean" style="color:#0000ff">true</span><span class="token punctuation">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token literal-property property">items</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">              </span><span class="token comment" style="color:#008000">// Value here corresponds to the internal types of the variables</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">              </span><span class="token comment" style="color:#008000">// in scratch-vm. And yes, broadcasts are actually variables.</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">              </span><span class="token comment" style="color:#008000">// https://github.com/TurboWarp/scratch-vm/blob/20c60193c1c567a65cca87b16d22c51963565a43/src/engine/variable.js#L43-L67</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">              </span><span class="token punctuation">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">                </span><span class="token literal-property property">text</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:#a31515">&#x27;variable&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">                </span><span class="token literal-property property">value</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:#a31515">&#x27;&#x27;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">              </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">              </span><span class="token string" style="color:#a31515">&#x27;list&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">              </span><span class="token punctuation">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">                </span><span class="token literal-property property">text</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:#a31515">&#x27;broadcast&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">                </span><span class="token literal-property property">value</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:#a31515">&#x27;broadcast_msg&#x27;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">              </span><span class="token punctuation">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token punctuation">]</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">          </span><span class="token punctuation">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token punctuation">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token function" style="color:#795e26">getSpriteName</span><span class="token punctuation">(</span><span class="token parameter">args</span><span class="token parameter punctuation">,</span><span class="token parameter"> util</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">      </span><span class="token keyword control-flow" style="color:#af00db">return</span><span class="token plain"> util</span><span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token method function property-access" style="color:#795e26">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token function" style="color:#795e26">doesVariableExist</span><span class="token punctuation">(</span><span class="token parameter">args</span><span class="token parameter punctuation">,</span><span class="token parameter"> util</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">      </span><span class="token keyword" style="color:#0000ff">const</span><span class="token plain"> variable </span><span class="token operator">=</span><span class="token plain"> util</span><span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token method function property-access" style="color:#795e26">lookupVariableByNameAndType</span><span class="token punctuation">(</span><span class="token plain">args</span><span class="token punctuation">.</span><span class="token constant" style="color:#267f99">NAME</span><span class="token punctuation">.</span><span class="token method function property-access" style="color:#795e26">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"> args</span><span class="token punctuation">.</span><span class="token constant" style="color:#267f99">TYPE</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">      </span><span class="token comment" style="color:#008000">// Remember: Boolean blocks need to explicitly return a boolean on their own</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">      </span><span class="token keyword control-flow" style="color:#af00db">return</span><span class="token plain"> </span><span class="token operator">!</span><span class="token operator">!</span><span class="token plain">variable</span><span class="token punctuation">;</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span><span class="token maybe-class-name">Scratch</span><span class="token punctuation">.</span><span class="token property-access">extensions</span><span class="token punctuation">.</span><span class="token method function property-access" style="color:#795e26">register</span><span class="token punctuation">(</span><span class="token keyword" style="color:#0000ff">new</span><span class="token plain"> </span><span class="token class-name" style="color:#267f99">BlockUtilityExamples</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token maybe-class-name">Scratch</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div>
<p>请注意，每个角色、脚本和积木块都共享相同的积木块工具对象。为了提高性能，它不会在每次运行积木块时创建一个对象，而是只更新共享对象的属性。因此，访问 <code>util</code> 的唯一安全时机是积木块刚运行时。尝试在 setTimeout、setInterval、Promise 回调或其他非同步回调中访问 <code>util</code> 将无法正常工作。如果您需要稍后访问 <code>util</code> 的属性，请提前将它们保存在变量中。</p>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token comment" style="color:#008000">// 这是不可靠的，可能会弹出错误的内容：</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token function" style="color:#795e26">myBlock</span><span class="token punctuation">(</span><span class="token parameter">args</span><span class="token parameter punctuation">,</span><span class="token parameter"> util</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token function" style="color:#795e26">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token function" style="color:#795e26">alert</span><span class="token punctuation">(</span><span class="token plain">util</span><span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token method function property-access" style="color:#795e26">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number" style="color:#098658">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token comment" style="color:#008000">// 这总是有效的：</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token function" style="color:#795e26">myBlock</span><span class="token punctuation">(</span><span class="token parameter">args</span><span class="token parameter punctuation">,</span><span class="token parameter"> util</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:#0000ff">const</span><span class="token plain"> target </span><span class="token operator">=</span><span class="token plain"> util</span><span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token function" style="color:#795e26">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">      </span><span class="token function" style="color:#795e26">alert</span><span class="token punctuation">(</span><span class="token plain">target</span><span class="token punctuation">.</span><span class="token method function property-access" style="color:#795e26">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number" style="color:#098658">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="常用模板">常用模板<a href="#常用模板" class="hash-link" aria-label="Direct link to 常用模板" title="Direct link to 常用模板">​</a></h2>
<p>这里是一些可以复制和粘贴的常用代码片段：</p>
<p>如果扩展必须以非沙盒化方式运行，在开始时添加这个：</p>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#af00db">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token maybe-class-name">Scratch</span><span class="token punctuation">.</span><span class="token property-access">extensions</span><span class="token punctuation">.</span><span class="token property-access">unsandboxed</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#af00db">throw</span><span class="token plain"> </span><span class="token keyword" style="color:#0000ff">new</span><span class="token plain"> </span><span class="token class-name" style="color:#267f99">Error</span><span class="token punctuation">(</span><span class="token string" style="color:#a31515">&#x27;Extension Name must run unsandboxed&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>如果您经常使用 <code>vm</code>、<code>runtime</code> 或 <code>Cast</code> API，常见的做法是在开始时定义它们以节省时间：</p>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token keyword" style="color:#0000ff">const</span><span class="token plain"> vm </span><span class="token operator">=</span><span class="token plain"> </span><span class="token maybe-class-name">Scratch</span><span class="token punctuation">.</span><span class="token property-access">vm</span><span class="token punctuation">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token keyword" style="color:#0000ff">const</span><span class="token plain"> runtime </span><span class="token operator">=</span><span class="token plain"> vm</span><span class="token punctuation">.</span><span class="token property-access">runtime</span><span class="token punctuation">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token keyword" style="color:#0000ff">const</span><span class="token plain"> </span><span class="token maybe-class-name">Cast</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token maybe-class-name">Scratch</span><span class="token punctuation">.</span><span class="token property-access maybe-class-name">Cast</span><span class="token punctuation">;</span><span class="token plain"> </span><span class="token comment" style="color:#008000">// 稍后讨论。</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="需要权限的-api">需要权限的 API<a href="#需要权限的-api" class="hash-link" aria-label="Direct link to 需要权限的 API" title="Direct link to 需要权限的 API">​</a></h2>
<p>虽然沙盒化扩展可以随意使用 fetch() 等 API，但非沙盒化扩展在向任何远程服务发出请求之前应该先请求权限。这让用户可以控制他们的隐私。虽然在运行时没有技术措施强制执行这一点，但这是 <a href="https://extensions.turbowarp.org" target="_blank" rel="noopener noreferrer">extensions.turbowarp.org</a> 上所有扩展的要求。</p>
<p>对一些流行服务（如 <a href="https://pages.github.com/" target="_blank" rel="noopener noreferrer">GitHub Pages</a> 或 <a href="https://about.gitlab.com/stages-devops-lifecycle/pages/" target="_blank" rel="noopener noreferrer">GitLab Pages</a>）的请求可能会自动获得批准，而对其他随机网站的请求可能会向用户显示提示。您不应该对此做任何假设，并且您的代码需要确保它可以优雅地处理用户拒绝提示的情况（扩展应该表现得与没有互联网连接时相同）。</p>
<p>这些需要权限的 API 还会自动防止项目通过尝试重定向到 <code>javascript:</code> URL 等方式运行任意 JavaScript。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="获取-apiwebsocket图像音频文件等">获取 API、WebSocket、图像、音频文件等<a href="#获取-apiwebsocket图像音频文件等" class="hash-link" aria-label="Direct link to 获取 API、WebSocket、图像、音频文件等" title="Direct link to 获取 API、WebSocket、图像、音频文件等">​</a></h3>
<p>使用 <code>Scratch.fetch(url)</code> 而不是 <code>fetch(url)</code>。在使用其他连接到远程网站的 API 之前，检查 <code>await Scratch.canFetch(url)</code>。</p>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:#008000">// 不要这样做：</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:#0000ff">const</span><span class="token plain"> response </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#af00db">await</span><span class="token plain"> </span><span class="token function" style="color:#795e26">fetch</span><span class="token punctuation">(</span><span class="token plain">url</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:#008000">// 应该这样做：</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:#0000ff">const</span><span class="token plain"> response </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#af00db">await</span><span class="token plain"> </span><span class="token maybe-class-name">Scratch</span><span class="token punctuation">.</span><span class="token method function property-access" style="color:#795e26">fetch</span><span class="token punctuation">(</span><span class="token plain">url</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:#008000">// 不要这样做：</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:#0000ff">const</span><span class="token plain"> ws </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:#0000ff">new</span><span class="token plain"> </span><span class="token class-name" style="color:#267f99">WebSocket</span><span class="token punctuation">(</span><span class="token plain">url</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:#008000">// 应该这样做：</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword control-flow" style="color:#af00db">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token keyword control-flow" style="color:#af00db">await</span><span class="token plain"> </span><span class="token maybe-class-name">Scratch</span><span class="token punctuation">.</span><span class="token method function property-access" style="color:#795e26">canFetch</span><span class="token punctuation">(</span><span class="token plain">url</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token keyword" style="color:#0000ff">const</span><span class="token plain"> ws </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:#0000ff">new</span><span class="token plain"> </span><span class="token class-name" style="color:#267f99">WebSocket</span><span class="token punctuation">(</span><span class="token plain">url</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:#008000">// 不要这样做：</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:#0000ff">const</span><span class="token plain"> image </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:#0000ff">new</span><span class="token plain"> </span><span class="token class-name" style="color:#267f99">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">image</span><span class="token punctuation">.</span><span class="token property-access">src</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> src</span><span class="token punctuation">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:#008000">// 应该这样做：</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword control-flow" style="color:#af00db">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token keyword control-flow" style="color:#af00db">await</span><span class="token plain"> </span><span class="token maybe-class-name">Scratch</span><span class="token punctuation">.</span><span class="token method function property-access" style="color:#795e26">canFetch</span><span class="token punctuation">(</span><span class="token plain">src</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token keyword" style="color:#0000ff">const</span><span class="token plain"> image </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:#0000ff">new</span><span class="token plain"> </span><span class="token class-name" style="color:#267f99">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  image</span><span class="token punctuation">.</span><span class="token property-access">src</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> src</span><span class="token punctuation">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:#008000">// 不要这样做：</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:#0000ff">const</span><span class="token plain"> audio </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:#0000ff">new</span><span class="token plain"> </span><span class="token class-name" style="color:#267f99">Audio</span><span class="token punctuation">(</span><span class="token plain">url</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:#008000">// 应该这样做：</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword control-flow" style="color:#af00db">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token keyword control-flow" style="color:#af00db">await</span><span class="token plain"> </span><span class="token maybe-class-name">Scratch</span><span class="token punctuation">.</span><span class="token method function property-access" style="color:#795e26">canFetch</span><span class="token punctuation">(</span><span class="token plain">url</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  </span><span class="token keyword" style="color:#0000ff">const</span><span class="token plain"> audio </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:#0000ff">new</span><span class="token plain"> </span><span class="token class-name" style="color:#267f99">Audio</span><span class="token punctuation">(</span><span class="token plain">url</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="打开新标签或窗口">打开新标签或窗口<a href="#打开新标签或窗口" class="hash-link" aria-label="Direct link to 打开新标签或窗口" title="Direct link to 打开新标签或窗口">​</a></h3>
<p>使用 <code>Scratch.openWindow(url)</code> 而不是 <code>window.open(url)</code>。<code>Scratch.openWindow</code> 总是将 target 设置为 <code>&quot;_blank&quot;</code> 以打开新标签或窗口。如果由于某种原因无法使用 <code>Scratch.openWindow(url)</code>，在调用 <code>window.open(url)</code> 之前检查 <code>await Scratch.canOpenWindow(url)</code>。</p>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:#008000">// 不要这样做：</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:#0000ff">const</span><span class="token plain"> win </span><span class="token operator">=</span><span class="token plain"> </span><span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token method function property-access" style="color:#795e26">open</span><span class="token punctuation">(</span><span class="token plain">url</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:#008000">// 应该这样做：</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:#0000ff">const</span><span class="token plain"> win </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#af00db">await</span><span class="token plain"> </span><span class="token maybe-class-name">Scratch</span><span class="token punctuation">.</span><span class="token method function property-access" style="color:#795e26">openWindow</span><span class="token punctuation">(</span><span class="token plain">url</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:#008000">// 不要这样做：</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:#0000ff">const</span><span class="token plain"> win </span><span class="token operator">=</span><span class="token plain"> </span><span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token method function property-access" style="color:#795e26">open</span><span class="token punctuation">(</span><span class="token plain">url</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string" style="color:#a31515">&#x27;_blank&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string" style="color:#a31515">&#x27;width=400,height=400&#x27;</span><span class="token punctuation">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:#008000">// 应该这样做：</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:#0000ff">const</span><span class="token plain"> win </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#af00db">await</span><span class="token plain"> </span><span class="token maybe-class-name">Scratch</span><span class="token punctuation">.</span><span class="token method function property-access" style="color:#795e26">openWindow</span><span class="token punctuation">(</span><span class="token plain">url</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string" style="color:#a31515">&#x27;width=400,height=400&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="重定向当前页面">重定向当前页面<a href="#重定向当前页面" class="hash-link" aria-label="Direct link to 重定向当前页面" title="Direct link to 重定向当前页面">​</a></h3>
<p>使用 <code>Scratch.redirect(url)</code> 而不是 <code>location.href = url</code>。如果无法使用 <code>Scratch.redirect(url)</code>，在运行 <code>location.href = url</code> 之前检查 <code>await Scratch.canRedirect(url)</code>。</p>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:#008000">// 不要这样做：</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token dom variable">location</span><span class="token punctuation">.</span><span class="token property-access">href</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> url</span><span class="token punctuation">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:#008000">// 应该这样做：</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword control-flow" style="color:#af00db">await</span><span class="token plain"> </span><span class="token maybe-class-name">Scratch</span><span class="token punctuation">.</span><span class="token method function property-access" style="color:#795e26">redirect</span><span class="token punctuation">(</span><span class="token plain">url</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="练习">练习<a href="#练习" class="hash-link" aria-label="Direct link to 练习" title="Direct link to 练习">​</a></h2>
<p>我们鼓励您在不使用提示的情况下尝试解决这些问题。这会让您更熟悉 VM 内部功能的工作方式。</p>
<ol>
<li>创建一个按下绿旗的积木块。（提示：<span style="transition:.2s background-color;border-radius:2px;cursor:pointer;background-color:currentcolor"><span style="opacity:0">vm.greenFlag</span></span>）</li>
<li>创建一个返回角色 x 坐标的积木块，类似于 &quot;x 坐标&quot; 积木块。（提示：<span style="transition:.2s background-color;border-radius:2px;cursor:pointer;background-color:currentcolor"><span style="opacity:0">target.x</span></span>）</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="下一步">下一步<a href="#下一步" class="hash-link" aria-label="Direct link to 下一步" title="Direct link to 下一步">​</a></h2>
<p>根据您使用的服务器，您可能已经厌倦了每次都记住硬重新加载所有内容。让我们学习一下 <a href="/development/extensions/better-development-server">更好的开发服务器</a>。</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/Lcyys666/TurboWarpdocs/edit/master/docs/development/extensions/unsandboxed.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/development/extensions/sandbox"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">沙盒到底是什么？</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/development/extensions/better-development-server"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">更好的开发服务器</div></a></nav></div></div></div></div></main></div></div></div></div>
</body>
</html>
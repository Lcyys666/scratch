<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-development/extensions/hats" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.1.0">
<title data-rh="true">事件和帽子积木块 | TurboWarp 文档</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://scratch.lcy-ys.top/development/extensions/hats"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="事件和帽子积木块 | TurboWarp 文档"><meta data-rh="true" name="description" content="事件积木块和帽子积木块是两种允许您控制脚本何时运行的积木块类型。尽管它们看起来相似，但它们是不同的。"><meta data-rh="true" property="og:description" content="事件积木块和帽子积木块是两种允许您控制脚本何时运行的积木块类型。尽管它们看起来相似，但它们是不同的。"><link data-rh="true" rel="canonical" href="https://scratch.lcy-ys.top/development/extensions/hats"><link data-rh="true" rel="alternate" href="https://scratch.lcy-ys.top/development/extensions/hats" hreflang="en"><link data-rh="true" rel="alternate" href="https://scratch.lcy-ys.top/development/extensions/hats" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://HORQ9E5CCA-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="TurboWarp 文档" href="/opensearch.xml"><link rel="stylesheet" href="/assets/css/styles.6e1a49a6.css">
<script src="/assets/js/runtime~main.918eff89.js" defer="defer"></script>
<script src="/assets/js/main.32cad34e.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();null!==e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,t("light"))}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><b class="navbar__title text--truncate">TurboWarp 文档</b></a><a class="navbar__item navbar__link" href="/packager">打包器</a><a class="navbar__item navbar__link" href="/development">开发</a></div><div class="navbar__items navbar__items--right"><a href="https://turbowarp.org/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">TurboWarp<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://github.com/TurboWarp" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/development">开发</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/development/extensions/introduction">自定义扩展教程</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/development/extensions/introduction">自定义扩展简介</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/development/extensions/hello-world">Hello, world!</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/development/extensions/inputs">处理输入</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/development/extensions/async">处理非即时操作</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/development/extensions/sandbox">沙盒到底是什么？</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/development/extensions/unsandboxed">非沙盒化扩展</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/development/extensions/better-development-server">更好的开发服务器</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/development/extensions/assorted-apis">各种 API</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/development/extensions/hats">  事件和帽子积木块</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/development/extensions/compatibility">维护兼容性</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/development/extensions/share">分享您的扩展</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/development/extensions/wrapping-up">总结</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/development/getting-started">修改入门</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/development/globals">全局变量</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/development/scratchx">ScratchX 和 TurboWarp</a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col"><div class="docItemContainer_Djhp"><article><div class="theme-doc-markdown markdown"><h1>事件和帽子积木块</h1>
<!-- -->
<!-- -->
<p>事件积木块和帽子积木块是两种允许您控制脚本何时运行的积木块类型。尽管它们看起来相似，但它们是不同的。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="事件积木块">事件积木块<a href="#事件积木块" class="hash-link" aria-label="Direct link to 事件积木块" title="Direct link to 事件积木块">​</a></h2>
<p>事件积木块用于响应外部事件运行脚本。一个例子是&quot;当绿旗被点击&quot; - 事件是用户点击绿旗按钮时。&quot;当角色被点击&quot;同样是在响应点击事件时运行，尽管 Scratch 做了更多工 作来确定事件发生在哪个角色上。事件积木块可以用于任何允许您运行回调的外部事件。</p>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_BuS1"><p>事件积木块仅在非沙盒化扩展中支持。</p></div></div>
<p>事件积木块永远不会被执行；它们只是标记要运行哪些脚本。例如，考虑这个您熟悉的积木块：</p>
<p><img loading="lazy" alt="当按下空格键" src="/assets/images/when-space-key-pressed-ce7c4470fd88589a73b7e0f7147edf2b.svg" width="165" height="50" class="img_ev3q"></p>
<p>当您运行这个积木块时，它本身不会做任何事情。它只是表明它下面的内容应该运行。我们可以使用 <code>Scratch.BlockType.EVENT</code> 创建具有类似功能的事件积木块：</p>
<div><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockTitle_Ktv7"><div>unsandboxed/when-space-key-pressed.js<!-- --> - <a target="_blank" rel="noopener noreferrer" href="https://turbowarp.org/editor?extension=https://extensions.turbowarp.org/docs-examples/unsandboxed/when-space-key-pressed.js">Try this extension</a></div></div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm"><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token punctuation">(</span><span class="token keyword" style="color:#0000ff">function</span><span class="token punctuation">(</span><span class="token parameter maybe-class-name">Scratch</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span><span class="token string" style="color:#a31515">&#x27;use strict&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#af00db">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token maybe-class-name">Scratch</span><span class="token punctuation">.</span><span class="token property-access">extensions</span><span class="token punctuation">.</span><span class="token property-access">unsandboxed</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#af00db">throw</span><span class="token plain"> </span><span class="token keyword" style="color:#0000ff">new</span><span class="token plain"> </span><span class="token class-name" style="color:#267f99">Error</span><span class="token punctuation">(</span><span class="token string" style="color:#a31515">&#x27;This example must run unsandboxed&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span><span class="token keyword" style="color:#0000ff">class</span><span class="token plain"> </span><span class="token class-name" style="color:#267f99">WhenSpaceKeyPressed</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token function" style="color:#795e26">getInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">      </span><span class="token keyword control-flow" style="color:#af00db">return</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token literal-property property">id</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:#a31515">&#x27;eventexampleunsandboxed&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token literal-property property">name</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:#a31515">&#x27;Event Block Example&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token literal-property property">blocks</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">          </span><span class="token punctuation">{</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token literal-property property">blockType</span><span class="token operator">:</span><span class="token plain"> </span><span class="token maybe-class-name">Scratch</span><span class="token punctuation">.</span><span class="token property-access maybe-class-name">BlockType</span><span class="token punctuation">.</span><span class="token constant" style="color:#267f99">EVENT</span><span class="token punctuation">,</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token literal-property property">opcode</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:#a31515">&#x27;whenSpacePressed&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token literal-property property">text</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:#a31515">&#x27;when space key pressed&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token literal-property property">isEdgeActivated</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean" style="color:#0000ff">false</span><span class="token plain"> </span><span class="token comment" style="color:#008000">// required boilerplate</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">          </span><span class="token punctuation">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token punctuation">]</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token comment" style="color:#008000">// Notice: whenSpacePressed does not have a function defined!</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span><span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access" style="color:#795e26">addEventListener</span><span class="token punctuation">(</span><span class="token string" style="color:#a31515">&#x27;keydown&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#af00db">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">e</span><span class="token punctuation">.</span><span class="token property-access">key</span><span class="token plain"> </span><span class="token operator">===</span><span class="token plain"> </span><span class="token string" style="color:#a31515">&#x27; &#x27;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">      </span><span class="token maybe-class-name">Scratch</span><span class="token punctuation">.</span><span class="token property-access">vm</span><span class="token punctuation">.</span><span class="token property-access">runtime</span><span class="token punctuation">.</span><span class="token method function property-access" style="color:#795e26">startHats</span><span class="token punctuation">(</span><span class="token string" style="color:#a31515">&#x27;eventexampleunsandboxed_whenSpacePressed&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span><span class="token maybe-class-name">Scratch</span><span class="token punctuation">.</span><span class="token property-access">extensions</span><span class="token punctuation">.</span><span class="token method function property-access" style="color:#795e26">register</span><span class="token punctuation">(</span><span class="token keyword" style="color:#0000ff">new</span><span class="token plain"> </span><span class="token class-name" style="color:#267f99">WhenSpaceKeyPressed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token maybe-class-name">Scratch</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div>
<p>我们稍后会讨论 <code>isEdgeActivated: false</code> 的含义，但对于事件积木块来说，这是<strong>必需的样板代码</strong>。</p>
<p>在这个例子中，我们定义了 opcode <code>whenSpacePressed</code>，但<strong>因为它是一个事件积木块，我们不为它编写任何代码。</strong></p>
<p>要启动事件积木块，您使用 startHats。这有两个版本：</p>
<ul>
<li><code>Scratch.vm.runtime.startHats</code> 应该在积木块外部使用（例如，点击绿旗）</li>
<li><code>util.startHats</code> 应该在积木块 内部使用（例如，广播积木块）</li>
</ul>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_BuS1"><p>在积木块内部使用 <code>Scratch.vm.runtime.startHats</code> 而不是 <code>util.startHats</code> 可能会破坏脚本执行。</p></div></div>
<p>参数和返回值<em>完全相同</em>。传递给 startHats 的第一个参数是<em>完整的</em>积木块 opcode，即 <code>extensionid_opcode</code>。在这个例子中，那就是 <code>eventexampleunsandboxed_whenSpacePressed</code>。这将开始运行项目中顶部积木块是这个 opcode 的所有脚本。</p>
<p>在这个例子中，我们使用了 keydown 事件，但您可以使用任何您想要的事件。尝试使用点击事件，或者 setTimeout/setInterval、fetch() 和其他 API。只要您能得到一个回调，这就会工作。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="通过菜单过滤">通过菜单过滤<a href="#通过菜单过滤" class="hash-link" aria-label="Direct link to 通过菜单过滤" title="Direct link to 通过菜单过滤">​</a></h2>
<p>您可能会注意到 Scratch 的内置&quot;当按下按键&quot;积木块有一个菜单。使用我们当前的扩展，我们需要为每个按键添加一个新的积木块。这不是理想的。相反，我们也可以使用菜单。</p>
<div><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockTitle_Ktv7"><div>unsandboxed/when-key-pressed.js<!-- --> - <a target="_blank" rel="noopener noreferrer" href="https://turbowarp.org/editor?extension=https://extensions.turbowarp.org/docs-examples/unsandboxed/when-key-pressed.js">Try this extension</a></div></div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm"><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token punctuation">(</span><span class="token keyword" style="color:#0000ff">function</span><span class="token punctuation">(</span><span class="token parameter maybe-class-name">Scratch</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span><span class="token string" style="color:#a31515">&#x27;use strict&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#af00db">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token maybe-class-name">Scratch</span><span class="token punctuation">.</span><span class="token property-access">extensions</span><span class="token punctuation">.</span><span class="token property-access">unsandboxed</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#af00db">throw</span><span class="token plain"> </span><span class="token keyword" style="color:#0000ff">new</span><span class="token plain"> </span><span class="token class-name" style="color:#267f99">Error</span><span class="token punctuation">(</span><span class="token string" style="color:#a31515">&#x27;This example must run unsandboxed&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span><span class="token keyword" style="color:#0000ff">class</span><span class="token plain"> </span><span class="token class-name" style="color:#267f99">WhenKeyPressed</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token function" style="color:#795e26">getInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">      </span><span class="token keyword control-flow" style="color:#af00db">return</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token literal-property property">id</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:#a31515">&#x27;eventexample2unsandboxed&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token literal-property property">name</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:#a31515">&#x27;Event Block Example 2&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token literal-property property">blocks</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">          </span><span class="token punctuation">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token literal-property property">blockType</span><span class="token operator">:</span><span class="token plain"> </span><span class="token maybe-class-name">Scratch</span><span class="token punctuation">.</span><span class="token property-access maybe-class-name">BlockType</span><span class="token punctuation">.</span><span class="token constant" style="color:#267f99">EVENT</span><span class="token punctuation">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token literal-property property">opcode</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:#a31515">&#x27;whenPressed&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token literal-property property">text</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:#a31515">&#x27;when [KEY] key pressed&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token literal-property property">isEdgeActivated</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean" style="color:#0000ff">false</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token comment" style="color:#008000">// required boilerplate</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token literal-property property">arguments</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">              </span><span class="token constant" style="color:#267f99">KEY</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">                </span><span class="token literal-property property">type</span><span class="token operator">:</span><span class="token plain"> </span><span class="token maybe-class-name">Scratch</span><span class="token punctuation">.</span><span class="token property-access maybe-class-name">ArgumentType</span><span class="token punctuation">.</span><span class="token constant" style="color:#267f99">STRING</span><span class="token punctuation">,</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">                </span><span class="token literal-property property">menu</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:#a31515">&#x27;key&#x27;</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">              </span><span class="token punctuation">}</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token punctuation">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">          </span><span class="token punctuation">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token literal-property property">menus</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">          </span><span class="token literal-property property">key</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token literal-property property">acceptReporters</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean" style="color:#0000ff">false</span><span class="token punctuation">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token literal-property property">items</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">              </span><span class="token punctuation">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">                </span><span class="token comment" style="color:#008000">// startHats filters by *value*, not by text</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">                </span><span class="token literal-property property">text</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:#a31515">&#x27;space&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">                </span><span class="token literal-property property">value</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:#a31515">&#x27; &#x27;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">              </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">              </span><span class="token string" style="color:#a31515">&#x27;a&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">              </span><span class="token string" style="color:#a31515">&#x27;b&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">              </span><span class="token string" style="color:#a31515">&#x27;c&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">              </span><span class="token comment" style="color:#008000">// ...</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token punctuation">]</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">          </span><span class="token punctuation">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token punctuation">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span><span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access" style="color:#795e26">addEventListener</span><span class="token punctuation">(</span><span class="token string" style="color:#a31515">&#x27;keydown&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token maybe-class-name">Scratch</span><span class="token punctuation">.</span><span class="token property-access">vm</span><span class="token punctuation">.</span><span class="token property-access">runtime</span><span class="token punctuation">.</span><span class="token method function property-access" style="color:#795e26">startHats</span><span class="token punctuation">(</span><span class="token string" style="color:#a31515">&#x27;eventexample2unsandboxed_whenPressed&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">      </span><span class="token constant" style="color:#267f99">KEY</span><span class="token operator">:</span><span class="token plain"> e</span><span class="token punctuation">.</span><span class="token property-access">key</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span><span class="token maybe-class-name">Scratch</span><span class="token punctuation">.</span><span class="token property-access">extensions</span><span class="token punctuation">.</span><span class="token method function property-access" style="color:#795e26">register</span><span class="token punctuation">(</span><span class="token keyword" style="color:#0000ff">new</span><span class="token plain"> </span><span class="token class-name" style="color:#267f99">WhenKeyPressed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token maybe-class-name">Scratch</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div>
<p>积木块的定义与其他积木块类似。请注意，事件积木块<strong>只支持字段菜单</strong>。您不能有文本输入或让某人放置积木块的地方。要通过参数过滤，它<strong>必须是一个 acceptReporters: false 的菜单</strong>。（稍后讨论的积木块类型对此更宽松。）</p>
<p>startHats 的第一个参数再次是完整的 opcode。startHats 的第二个参数是一个用于过滤要激活哪些事件的对象。这个对象中的键名是积木块的参数名（在这个例子中是 <code>KEY</code>），值对应于菜单的值（不是文本！）。如果您想要，可以通过多个键进行  过滤，所有键都必须匹配。</p>
<p>Scratch 中真正的&quot;当按下按键&quot;积木块比这个更复杂。这只是一个例子。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="通过角色过滤">通过角色过滤<a href="#通过角色过滤" class="hash-link" aria-label="Direct link to 通过角色过滤" title="Direct link to 通过角色过滤">​</a></h2>
<p>Scratch 的&quot;当角色被点击&quot;积木块只在一个角色上运行，而不是每个角色。要做到这一点，您可以使用 startHats 的第三个（也是最后一个）参数。第三个参数可以设置为一个目标对象 -- 每个角色或克隆都是一个&quot;目标&quot;。如果设置，只有该目标中的事件积木块会运行。</p>
<p>获取目标对象最常见的方法是：</p>
<ul>
<li><code>Scratch.vm.runtime.getTargetForStage()</code> 获取舞台目标</li>
<li><code>Scratch.vm.runtime.getSpriteTargetByName(&quot;Sprite1&quot;)</code> 获取具有给定名称的非克隆目标</li>
<li><code>Scratch.vm.runtime.targets</code> 获取完整列表以自行搜索</li>
</ul>
<p>在这个例子中，我们修改了之前的扩展，使其只在舞台中运行积木块。</p>
<div><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockTitle_Ktv7"><div>unsandboxed/when-key-pressed-stage.js<!-- --> - <a target="_blank" rel="noopener noreferrer" href="https://turbowarp.org/editor?extension=https://extensions.turbowarp.org/docs-examples/unsandboxed/when-key-pressed-stage.js">Try this extension</a></div></div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm"><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token punctuation">(</span><span class="token keyword" style="color:#0000ff">function</span><span class="token punctuation">(</span><span class="token parameter maybe-class-name">Scratch</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span><span class="token string" style="color:#a31515">&#x27;use strict&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#af00db">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token maybe-class-name">Scratch</span><span class="token punctuation">.</span><span class="token property-access">extensions</span><span class="token punctuation">.</span><span class="token property-access">unsandboxed</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#af00db">throw</span><span class="token plain"> </span><span class="token keyword" style="color:#0000ff">new</span><span class="token plain"> </span><span class="token class-name" style="color:#267f99">Error</span><span class="token punctuation">(</span><span class="token string" style="color:#a31515">&#x27;This example must run unsandboxed&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span><span class="token keyword" style="color:#0000ff">class</span><span class="token plain"> </span><span class="token class-name" style="color:#267f99">WhenKeyPressedInStage</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token function" style="color:#795e26">getInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">      </span><span class="token keyword control-flow" style="color:#af00db">return</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token literal-property property">id</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:#a31515">&#x27;eventexample3unsandboxed&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token literal-property property">name</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:#a31515">&#x27;Event Block Example 3&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token literal-property property">blocks</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">          </span><span class="token punctuation">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token literal-property property">blockType</span><span class="token operator">:</span><span class="token plain"> </span><span class="token maybe-class-name">Scratch</span><span class="token punctuation">.</span><span class="token property-access maybe-class-name">BlockType</span><span class="token punctuation">.</span><span class="token constant" style="color:#267f99">EVENT</span><span class="token punctuation">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token literal-property property">opcode</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:#a31515">&#x27;whenPressed&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token literal-property property">text</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:#a31515">&#x27;when [KEY] key pressed&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token literal-property property">isEdgeActivated</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean" style="color:#0000ff">false</span><span class="token punctuation">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token literal-property property">arguments</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">              </span><span class="token constant" style="color:#267f99">KEY</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">                </span><span class="token literal-property property">type</span><span class="token operator">:</span><span class="token plain"> </span><span class="token maybe-class-name">Scratch</span><span class="token punctuation">.</span><span class="token property-access maybe-class-name">ArgumentType</span><span class="token punctuation">.</span><span class="token constant" style="color:#267f99">STRING</span><span class="token punctuation">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">                </span><span class="token literal-property property">menu</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:#a31515">&#x27;key&#x27;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">              </span><span class="token punctuation">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token punctuation">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">          </span><span class="token punctuation">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token literal-property property">menus</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">          </span><span class="token literal-property property">key</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token literal-property property">acceptReporters</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean" style="color:#0000ff">false</span><span class="token punctuation">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token literal-property property">items</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">              </span><span class="token punctuation">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">                </span><span class="token literal-property property">text</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:#a31515">&#x27;space&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">                </span><span class="token literal-property property">value</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:#a31515">&#x27; &#x27;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">              </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">              </span><span class="token string" style="color:#a31515">&#x27;a&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">              </span><span class="token string" style="color:#a31515">&#x27;b&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">              </span><span class="token string" style="color:#a31515">&#x27;c&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">              </span><span class="token comment" style="color:#008000">// ...</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token punctuation">]</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">          </span><span class="token punctuation">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token punctuation">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span><span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access" style="color:#795e26">addEventListener</span><span class="token punctuation">(</span><span class="token string" style="color:#a31515">&#x27;keydown&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token maybe-class-name">Scratch</span><span class="token punctuation">.</span><span class="token property-access">vm</span><span class="token punctuation">.</span><span class="token property-access">runtime</span><span class="token punctuation">.</span><span class="token method function property-access" style="color:#795e26">startHats</span><span class="token punctuation">(</span><span class="token string" style="color:#a31515">&#x27;eventexample3unsandboxed_whenPressed&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">      </span><span class="token constant" style="color:#267f99">KEY</span><span class="token operator">:</span><span class="token plain"> e</span><span class="token punctuation">.</span><span class="token property-access">key</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token maybe-class-name">Scratch</span><span class="token punctuation">.</span><span class="token property-access">vm</span><span class="token punctuation">.</span><span class="token property-access">runtime</span><span class="token punctuation">.</span><span class="token method function property-access" style="color:#795e26">getTargetForStage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span><span class="token maybe-class-name">Scratch</span><span class="token punctuation">.</span><span class="token property-access">extensions</span><span class="token punctuation">.</span><span class="token method function property-access" style="color:#795e26">register</span><span class="token punctuation">(</span><span class="token keyword" style="color:#0000ff">new</span><span class="token plain"> </span><span class="token class-name" style="color:#267f99">WhenKeyPressedInStage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token maybe-class-name">Scratch</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div>
<p>要只按角色过滤而不按字段过滤，您可以将第二个参数设置为 null 或空对象（<code>{}</code>）。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="重启现有线程">重启现有线程<a href="#重启现有线程" class="hash-link" aria-label="Direct link to 重启现有线程" title="Direct link to 重启现有线程">​</a></h2>
<p>考虑这个脚本：</p>
<p><img loading="lazy" src="/assets/images/when-space-pressed-wait-then-say-c6bb3dc15d85abfa750154490ee50ede.svg" width="166" height="115" class="img_ev3q"></p>
<p>您可能会观察到，如果您重复按空格键，脚本不会重启（这会重置等待积木块的计时器） -- 它只是继续执行。如果这不是您想要的，在积木块上设置 <code>shouldRestartExistingThreads: true</code>。</p>
<div><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockTitle_Ktv7"><div>unsandboxed/when-key-pressed-restart.js<!-- --> - <a target="_blank" rel="noopener noreferrer" href="https://turbowarp.org/editor?extension=https://extensions.turbowarp.org/docs-examples/unsandboxed/when-key-pressed-restart.js">Try this extension</a></div></div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm"><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token punctuation">(</span><span class="token keyword" style="color:#0000ff">function</span><span class="token punctuation">(</span><span class="token parameter maybe-class-name">Scratch</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span><span class="token string" style="color:#a31515">&#x27;use strict&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#af00db">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token maybe-class-name">Scratch</span><span class="token punctuation">.</span><span class="token property-access">extensions</span><span class="token punctuation">.</span><span class="token property-access">unsandboxed</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#af00db">throw</span><span class="token plain"> </span><span class="token keyword" style="color:#0000ff">new</span><span class="token plain"> </span><span class="token class-name" style="color:#267f99">Error</span><span class="token punctuation">(</span><span class="token string" style="color:#a31515">&#x27;This example must run unsandboxed&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span><span class="token keyword" style="color:#0000ff">class</span><span class="token plain"> </span><span class="token class-name" style="color:#267f99">WhenKeyPressed</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token function" style="color:#795e26">getInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">      </span><span class="token keyword control-flow" style="color:#af00db">return</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token literal-property property">id</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:#a31515">&#x27;restartexampleunsandboxed&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token literal-property property">name</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:#a31515">&#x27;Restart Threads Example&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token literal-property property">blocks</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">          </span><span class="token punctuation">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token literal-property property">blockType</span><span class="token operator">:</span><span class="token plain"> </span><span class="token maybe-class-name">Scratch</span><span class="token punctuation">.</span><span class="token property-access maybe-class-name">BlockType</span><span class="token punctuation">.</span><span class="token constant" style="color:#267f99">EVENT</span><span class="token punctuation">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token literal-property property">opcode</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:#a31515">&#x27;whenPressed&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token literal-property property">text</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:#a31515">&#x27;when [KEY] key pressed&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token literal-property property">isEdgeActivated</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean" style="color:#0000ff">false</span><span class="token punctuation">,</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token literal-property property">shouldRestartExistingThreads</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean" style="color:#0000ff">true</span><span class="token punctuation">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token literal-property property">arguments</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">              </span><span class="token constant" style="color:#267f99">KEY</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">                </span><span class="token literal-property property">type</span><span class="token operator">:</span><span class="token plain"> </span><span class="token maybe-class-name">Scratch</span><span class="token punctuation">.</span><span class="token property-access maybe-class-name">ArgumentType</span><span class="token punctuation">.</span><span class="token constant" style="color:#267f99">STRING</span><span class="token punctuation">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">                </span><span class="token literal-property property">menu</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:#a31515">&#x27;key&#x27;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">              </span><span class="token punctuation">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token punctuation">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">          </span><span class="token punctuation">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token literal-property property">menus</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">          </span><span class="token literal-property property">key</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token literal-property property">acceptReporters</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean" style="color:#0000ff">false</span><span class="token punctuation">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token literal-property property">items</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">              </span><span class="token punctuation">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">                </span><span class="token literal-property property">text</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:#a31515">&#x27;space&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">                </span><span class="token literal-property property">value</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:#a31515">&#x27; &#x27;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">              </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">              </span><span class="token string" style="color:#a31515">&#x27;a&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">              </span><span class="token string" style="color:#a31515">&#x27;b&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">              </span><span class="token string" style="color:#a31515">&#x27;c&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">              </span><span class="token comment" style="color:#008000">// ...</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token punctuation">]</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">          </span><span class="token punctuation">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token punctuation">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span><span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access" style="color:#795e26">addEventListener</span><span class="token punctuation">(</span><span class="token string" style="color:#a31515">&#x27;keydown&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token maybe-class-name">Scratch</span><span class="token punctuation">.</span><span class="token property-access">vm</span><span class="token punctuation">.</span><span class="token property-access">runtime</span><span class="token punctuation">.</span><span class="token method function property-access" style="color:#795e26">startHats</span><span class="token punctuation">(</span><span class="token string" style="color:#a31515">&#x27;restartexampleunsandboxed_whenPressed&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">      </span><span class="token constant" style="color:#267f99">KEY</span><span class="token operator">:</span><span class="token plain"> e</span><span class="token punctuation">.</span><span class="token property-access">key</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span><span class="token maybe-class-name">Scratch</span><span class="token punctuation">.</span><span class="token property-access">extensions</span><span class="token punctuation">.</span><span class="token method function property-access" style="color:#795e26">register</span><span class="token punctuation">(</span><span class="token keyword" style="color:#0000ff">new</span><span class="token plain"> </span><span class="token class-name" style="color:#267f99">WhenKeyPressed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token maybe-class-name">Scratch</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div>
<p>如果您重新创建相同的脚本，只要您重复按空格键，say 积木块就永远不会执行，因为脚本每次都会重启，这会重置等待积木块的计时器。</p>
<p>请注意，如果顶部积木块有 <code>shouldRestartExistingThreads: true</code> 的脚本对自己调用 startHats（类似于&quot;当收到消息1：广播消息1&quot;），当前运行的脚本将被标记为重启，但会继续运行积木块直到它让出。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="已启动线程列表">已启动线程列表<a href="#已启动线程列表" class="hash-link" aria-label="Direct link to 已启动线程列表" title="Direct link to 已启动线程列表">​</a></h2>
<p>最后，startHats 返回它启动的 Thread 对象数组。您可以使用它来监控线程状态、确定启动了多少个线程等。</p>
<div><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockTitle_Ktv7"><div>unsandboxed/broadcast-5.js<!-- --> - <a target="_blank" rel="noopener noreferrer" href="https://turbowarp.org/editor?extension=https://extensions.turbowarp.org/docs-examples/unsandboxed/broadcast-5.js">Try this extension</a></div></div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm"><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token punctuation">(</span><span class="token keyword" style="color:#0000ff">function</span><span class="token punctuation">(</span><span class="token parameter maybe-class-name">Scratch</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span><span class="token string" style="color:#a31515">&#x27;use strict&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span><span class="token keyword" style="color:#0000ff">class</span><span class="token plain"> </span><span class="token class-name" style="color:#267f99">Broadcast5</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token function" style="color:#795e26">getInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">      </span><span class="token keyword control-flow" style="color:#af00db">return</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token literal-property property">id</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:#a31515">&#x27;broadcast5example&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token literal-property property">name</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:#a31515">&#x27;Broadcast Example 5&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token literal-property property">blocks</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">          </span><span class="token punctuation">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token literal-property property">opcode</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:#a31515">&#x27;whenReceived&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token literal-property property">blockType</span><span class="token operator">:</span><span class="token plain"> </span><span class="token maybe-class-name">Scratch</span><span class="token punctuation">.</span><span class="token property-access maybe-class-name">BlockType</span><span class="token punctuation">.</span><span class="token constant" style="color:#267f99">HAT</span><span class="token punctuation">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token literal-property property">text</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:#a31515">&#x27;when I receive [EVENT_OPTION]&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token literal-property property">isEdgeActivated</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean" style="color:#0000ff">false</span><span class="token punctuation">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token literal-property property">arguments</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">              </span><span class="token constant" style="color:#267f99">EVENT_OPTION</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">                </span><span class="token literal-property property">type</span><span class="token operator">:</span><span class="token plain"> </span><span class="token maybe-class-name">Scratch</span><span class="token punctuation">.</span><span class="token property-access maybe-class-name">ArgumentType</span><span class="token punctuation">.</span><span class="token constant" style="color:#267f99">STRING</span><span class="token punctuation">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">                </span><span class="token literal-property property">menu</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:#a31515">&#x27;EVENT_FIELD&#x27;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">              </span><span class="token punctuation">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token punctuation">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">          </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">          </span><span class="token punctuation">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token literal-property property">opcode</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:#a31515">&#x27;broadcast&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token literal-property property">blockType</span><span class="token operator">:</span><span class="token plain"> </span><span class="token maybe-class-name">Scratch</span><span class="token punctuation">.</span><span class="token property-access maybe-class-name">BlockType</span><span class="token punctuation">.</span><span class="token constant" style="color:#267f99">REPORTER</span><span class="token punctuation">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token literal-property property">text</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:#a31515">&#x27;broadcast [EVENT]&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token literal-property property">arguments</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">              </span><span class="token constant" style="color:#267f99">EVENT</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">                </span><span class="token literal-property property">type</span><span class="token operator">:</span><span class="token plain"> </span><span class="token maybe-class-name">Scratch</span><span class="token punctuation">.</span><span class="token property-access maybe-class-name">ArgumentType</span><span class="token punctuation">.</span><span class="token constant" style="color:#267f99">STRING</span><span class="token punctuation">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">                </span><span class="token literal-property property">menu</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:#a31515">&#x27;EVENT_FIELD&#x27;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">              </span><span class="token punctuation">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token punctuation">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">          </span><span class="token punctuation">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token literal-property property">menus</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">          </span><span class="token constant" style="color:#267f99">EVENT_FIELD</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token literal-property property">acceptReporters</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean" style="color:#0000ff">false</span><span class="token punctuation">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token literal-property property">items</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">              </span><span class="token string" style="color:#a31515">&#x27;Event 1&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">              </span><span class="token string" style="color:#a31515">&#x27;Event 2&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">              </span><span class="token string" style="color:#a31515">&#x27;Event 3&#x27;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token punctuation">]</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">          </span><span class="token punctuation">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token punctuation">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token function" style="color:#795e26">broadcast</span><span class="token punctuation">(</span><span class="token parameter punctuation">{</span><span class="token parameter constant" style="color:#267f99">EVENT</span><span class="token parameter punctuation">,</span><span class="token parameter"> </span><span class="token parameter constant" style="color:#267f99">TARGET</span><span class="token parameter punctuation">}</span><span class="token parameter punctuation">,</span><span class="token parameter"> util</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">      </span><span class="token keyword" style="color:#0000ff">const</span><span class="token plain"> threads </span><span class="token operator">=</span><span class="token plain"> util</span><span class="token punctuation">.</span><span class="token method function property-access" style="color:#795e26">startHats</span><span class="token punctuation">(</span><span class="token string" style="color:#a31515">&#x27;broadcast5example_whenReceived&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token constant" style="color:#267f99">EVENT_OPTION</span><span class="token operator">:</span><span class="token plain"> </span><span class="token constant" style="color:#267f99">EVENT</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">      </span><span class="token keyword control-flow" style="color:#af00db">return</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#a31515">`</span><span class="token template-string string" style="color:#a31515">Started </span><span class="token template-string interpolation interpolation-punctuation punctuation">${</span><span class="token template-string interpolation">threads</span><span class="token template-string interpolation punctuation">.</span><span class="token template-string interpolation property-access">length</span><span class="token template-string interpolation interpolation-punctuation punctuation">}</span><span class="token template-string string" style="color:#a31515"> new threads!</span><span class="token template-string template-punctuation string" style="color:#a31515">`</span><span class="token punctuation">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span><span class="token maybe-class-name">Scratch</span><span class="token punctuation">.</span><span class="token property-access">extensions</span><span class="token punctuation">.</span><span class="token method function property-access" style="color:#795e26">register</span><span class="token punctuation">(</span><span class="token keyword" style="color:#0000ff">new</span><span class="token plain"> </span><span class="token class-name" style="color:#267f99">Broadcast5</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token maybe-class-name">Scratch</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="基于谓词的帽子积木块">基于谓词的帽子积木块<a href="#基于谓词 的帽子积木块" class="hash-link" aria-label="Direct link to 基于谓词的帽子积木块" title="Direct link to 基于谓词的帽子积木块">​</a></h2>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>基于谓词的帽子积木块仅在非沙盒化扩展中支持。</p></div></div>
<p>基于谓词的帽子积木块让您可以创建类似这样的内容：</p>
<p><img loading="lazy" src="/assets/images/forever-if-something-then-e1c84831edf86134186a58f91f2517f4.svg" width="154" height="185" class="img_ev3q"></p>
<p>基于谓词的帽子基本上是事件积木块的一个更强大的版本。它使用相同的 startHats 并支持 <code>shouldRestartExistingThreads</code>。除此之外，帽子积木块必须定义一个返回 true 或 false 的函数。所有积木块的输入都会被评估，然后帽子积木块可以使用这些信息来确定它下面的积木块是否应该运行。积木块类型是 <code>Scratch.BlockType.HAT</code>。我们可以将上面的内容近似为：</p>
<div><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockTitle_Ktv7"><div>unsandboxed/when.js<!-- --> - <a target="_blank" rel="noopener noreferrer" href="https://turbowarp.org/editor?extension=https://extensions.turbowarp.org/docs-examples/unsandboxed/when.js">Try this extension</a></div></div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm"><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token punctuation">(</span><span class="token keyword" style="color:#0000ff">function</span><span class="token punctuation">(</span><span class="token parameter maybe-class-name">Scratch</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span><span class="token string" style="color:#a31515">&#x27;use strict&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#af00db">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token maybe-class-name">Scratch</span><span class="token punctuation">.</span><span class="token property-access">extensions</span><span class="token punctuation">.</span><span class="token property-access">unsandboxed</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#af00db">throw</span><span class="token plain"> </span><span class="token keyword" style="color:#0000ff">new</span><span class="token plain"> </span><span class="token class-name" style="color:#267f99">Error</span><span class="token punctuation">(</span><span class="token string" style="color:#a31515">&#x27;This example must run unsandboxed&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span><span class="token keyword" style="color:#0000ff">class</span><span class="token plain"> </span><span class="token class-name" style="color:#267f99">When</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token function" style="color:#795e26">getInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">      </span><span class="token keyword control-flow" style="color:#af00db">return</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token literal-property property">id</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:#a31515">&#x27;whenunsandboxed&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token literal-property property">name</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:#a31515">&#x27;When&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token literal-property property">blocks</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">          </span><span class="token punctuation">{</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token literal-property property">blockType</span><span class="token operator">:</span><span class="token plain"> </span><span class="token maybe-class-name">Scratch</span><span class="token punctuation">.</span><span class="token property-access maybe-class-name">BlockType</span><span class="token punctuation">.</span><span class="token constant" style="color:#267f99">HAT</span><span class="token punctuation">,</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token literal-property property">opcode</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:#a31515">&#x27;when&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token literal-property property">text</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:#a31515">&#x27;when [CONDITION]&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token literal-property property">isEdgeActivated</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean" style="color:#0000ff">false</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token comment" style="color:#008000">// required boilerplate</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token literal-property property">arguments</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">              </span><span class="token constant" style="color:#267f99">CONDITION</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">                </span><span class="token literal-property property">type</span><span class="token operator">:</span><span class="token plain"> </span><span class="token maybe-class-name">Scratch</span><span class="token punctuation">.</span><span class="token property-access maybe-class-name">BlockType</span><span class="token punctuation">.</span><span class="token constant" style="color:#267f99">BOOLEAN</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">              </span><span class="token punctuation">}</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token punctuation">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">          </span><span class="token punctuation">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token punctuation">]</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token function" style="color:#795e26">when</span><span class="token punctuation">(</span><span class="token parameter">args</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">      </span><span class="token keyword control-flow" style="color:#af00db">return</span><span class="token plain"> </span><span class="token maybe-class-name">Scratch</span><span class="token punctuation">.</span><span class="token property-access maybe-class-name">Cast</span><span class="token punctuation">.</span><span class="token method function property-access" style="color:#795e26">toBoolean</span><span class="token punctuation">(</span><span class="token plain">args</span><span class="token punctuation">.</span><span class="token constant" style="color:#267f99">CONDITION</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span><span class="token maybe-class-name">Scratch</span><span class="token punctuation">.</span><span class="token property-access">vm</span><span class="token punctuation">.</span><span class="token property-access">runtime</span><span class="token punctuation">.</span><span class="token method function property-access" style="color:#795e26">on</span><span class="token punctuation">(</span><span class="token string" style="color:#a31515">&#x27;BEFORE_EXECUTE&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token comment" style="color:#008000">// startHats is the same as before!</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token maybe-class-name">Scratch</span><span class="token punctuation">.</span><span class="token property-access">vm</span><span class="token punctuation">.</span><span class="token property-access">runtime</span><span class="token punctuation">.</span><span class="token method function property-access" style="color:#795e26">startHats</span><span class="token punctuation">(</span><span class="token string" style="color:#a31515">&#x27;whenunsandboxed_when&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span><span class="token maybe-class-name">Scratch</span><span class="token punctuation">.</span><span class="token property-access">extensions</span><span class="token punctuation">.</span><span class="token method function property-access" style="color:#795e26">register</span><span class="token punctuation">(</span><span class="token keyword" style="color:#0000ff">new</span><span class="token plain"> </span><span class="token class-name" style="color:#267f99">When</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token maybe-class-name">Scratch</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div>
<p>您可以这样测试积木块：</p>
<p><img loading="lazy" src="/assets/images/when-touching-mouse-change-by-1-a6bf31b88bb23a8ca45dd1914b521d77.svg" width="215" height="88" class="img_ev3q"></p>
<p>请注意，这并不完全相同。如果没有视觉变化或项目处于涡轮模式，forever 积木块每帧会运行很多很多次，而帽子积木块每帧只会运行一次。</p>
<p><code>isEdgeActivated: false</code> 再次是必需的样板代码。积木块的定义与其他任何积木块相同。startHats 的工作方式与事件积木块完全相同：第一个参数是<em>完整的</em> opcode，然后是可选字段过滤器，然后是可选目标过滤器。</p>
<p>重要的区别是 <code>when</code> 实际上有代码。在您执行 startHats 后，积木块的输入和参数将被评估并传递给积木块。积木块可以返回 <code>true</code> 让脚本运行，或返回 <code>false</code> 阻止它运行。如果需要，积木块也可以返回一个解析为 <code>true</code> 或 <code>false</code> 的 Promise。</p>
<p>这里的一个棘手之处是 Scratch 不会自动启动基于谓词的帽子积木块 -- 您需要自己启动它们。在这个例子中，我们使用 <code>BEFORE_EXECUTE</code> 事件（顾名思义，它在任何脚本运行之前运行，所以您在这里启动的任何内容都会在该帧期间运行）。与事件积木块一样，您可以从任何获得回调的地方运行基于谓词的帽子积木块。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="边缘激活的帽子积木块">边缘激活的帽子积木块<a href="#边缘激活的帽子积木块" class="hash-link" aria-label="Direct link to 边缘激活的帽子积木块" title="Direct link to 边缘激活的帽子积木块">​</a></h2>
<p>基于谓词的帽子让您在条件<em>为</em>真时运行脚本。边缘激活的帽子积木块让您在条件<em>变为</em>真时运行脚本。</p>
<p>这是一个微妙但重要的区别。考虑这两个脚本：</p>
<p><img loading="lazy" src="/assets/images/when-timer-differences-6789504fa714f12b6fbd1f19c661cb04.svg" width="186" height="207" class="img_ev3q"></p>
<p>虽然积木块可能看起来相似，但它们有一个重要的区别。上面的积木块只会在计时器<em>变为</em> 5 时运行<em>一次</em>，而下面的积木块会在计时器达到 5 后重复运行。</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>边缘激活的帽子可以在任何扩展中使用，甚至是沙盒化的扩展</p></div></div>
<p>让我们思考如何使用普通的 Scratch 积木块实现这一点。您可以尝试这样的东西：</p>
<p><img loading="lazy" src="/assets/images/wait-until-something-true-db03785b4bf2fadf7188b8da3ba5bb7d.svg" width="171" height="115" class="img_ev3q"></p>
<p>这只会工作一次。我们如何让它无限次工作？</p>
<p><img loading="lazy" src="/assets/images/forever-wait-until-something-true-f3eb714c100b6ea9c059db50f8879ce4.svg" width="182" height="163" class="img_ev3q"></p>
<p>差不多了。边缘激活的帽子等待条件变为假，然后脚本才能再次运行 -- 如果条件已经为真，它就不能<em>变为真</em>。</p>
<p><img loading="lazy" src="/assets/images/forever-wait-until-something-true-then-not-true-0d4fa8c6dfc5315f5a3f5316edc9260e.svg" width="221" height="201" class="img_ev3q"></p>
<p>本质上，边缘激活的帽子让我们将那个循环重写为：</p>
<p><img loading="lazy" src="/assets/images/when-something-is-true-c0c4f323c4f9fef2f9a0503012d692f9.svg" width="126" height="82" class="img_ev3q"></p>
<p>为了演示这一点，我们可以编写一个类似于 Scratch 的&quot;当计时器大于&quot;积木块的扩展。积木块类型再次是 <code>Scratch.BlockType.HAT</code>，但这次使用 <code>isEdgeActivated: true</code>：</p>
<div><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockTitle_Ktv7"><div>timer-reimplementation.js<!-- --> - <a target="_blank" rel="noopener noreferrer" href="https://turbowarp.org/editor?extension=/example-extensions/timer-reimplementation.js">Try this extension</a></div></div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm"><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token keyword" style="color:#0000ff">let</span><span class="token plain"> startTime </span><span class="token operator">=</span><span class="token plain"> </span><span class="token known-class-name class-name" style="color:#267f99">Date</span><span class="token punctuation">.</span><span class="token method function property-access" style="color:#795e26">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:#0000ff">class</span><span class="token plain"> </span><span class="token class-name" style="color:#267f99">TimerReimplementationExample</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span><span class="token function" style="color:#795e26">getInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#af00db">return</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">      </span><span class="token literal-property property">id</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:#a31515">&#x27;timerreimplementationexample&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">      </span><span class="token literal-property property">name</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:#a31515">&#x27;Timer Example&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">      </span><span class="token literal-property property">blocks</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token punctuation">{</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">          </span><span class="token literal-property property">opcode</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:#a31515">&#x27;whenTimerGreaterThan&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">          </span><span class="token literal-property property">blockType</span><span class="token operator">:</span><span class="token plain"> </span><span class="token maybe-class-name">Scratch</span><span class="token punctuation">.</span><span class="token property-access maybe-class-name">BlockType</span><span class="token punctuation">.</span><span class="token constant" style="color:#267f99">HAT</span><span class="token punctuation">,</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">          </span><span class="token literal-property property">text</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:#a31515">&#x27;when timer &gt; [TIME]&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">          </span><span class="token literal-property property">isEdgeActivated</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean" style="color:#0000ff">true</span><span class="token punctuation">,</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">          </span><span class="token literal-property property">arguments</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token constant" style="color:#267f99">TIME</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">              </span><span class="token literal-property property">type</span><span class="token operator">:</span><span class="token plain"> </span><span class="token maybe-class-name">Scratch</span><span class="token punctuation">.</span><span class="token property-access maybe-class-name">ArgumentType</span><span class="token punctuation">.</span><span class="token constant" style="color:#267f99">NUMBER</span><span class="token punctuation">,</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">              </span><span class="token literal-property property">defaultValue</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:#a31515">&#x27;3&#x27;</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token punctuation">}</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">          </span><span class="token punctuation">}</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token punctuation">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">          </span><span class="token literal-property property">opcode</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:#a31515">&#x27;timer&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">          </span><span class="token literal-property property">blockType</span><span class="token operator">:</span><span class="token plain"> </span><span class="token maybe-class-name">Scratch</span><span class="token punctuation">.</span><span class="token property-access maybe-class-name">BlockType</span><span class="token punctuation">.</span><span class="token constant" style="color:#267f99">REPORTER</span><span class="token punctuation">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">          </span><span class="token literal-property property">text</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:#a31515">&#x27;timer&#x27;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token punctuation">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">          </span><span class="token literal-property property">opcode</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:#a31515">&#x27;resetTimer&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">          </span><span class="token literal-property property">blockType</span><span class="token operator">:</span><span class="token plain"> </span><span class="token maybe-class-name">Scratch</span><span class="token punctuation">.</span><span class="token property-access maybe-class-name">BlockType</span><span class="token punctuation">.</span><span class="token constant" style="color:#267f99">COMMAND</span><span class="token punctuation">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">          </span><span class="token literal-property property">text</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string" style="color:#a31515">&#x27;reset timer&#x27;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token punctuation">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">      </span><span class="token punctuation">]</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span><span class="token function" style="color:#795e26">whenTimerGreaterThan</span><span class="token punctuation">(</span><span class="token parameter punctuation">{</span><span class="token parameter constant" style="color:#267f99">TIME</span><span class="token parameter punctuation">}</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token console class-name" style="color:#267f99">console</span><span class="token punctuation">.</span><span class="token method function property-access" style="color:#795e26">log</span><span class="token punctuation">(</span><span class="token keyword" style="color:#0000ff">this</span><span class="token punctuation">.</span><span class="token method function property-access" style="color:#795e26">timer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token keyword" style="color:#0000ff">this</span><span class="token punctuation">.</span><span class="token method function property-access" style="color:#795e26">timer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token maybe-class-name">Scratch</span><span class="token punctuation">.</span><span class="token property-access maybe-class-name">Cast</span><span class="token punctuation">.</span><span class="token method function property-access" style="color:#795e26">toNumber</span><span class="token punctuation">(</span><span class="token constant" style="color:#267f99">TIME</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#af00db">return</span><span class="token plain"> </span><span class="token keyword" style="color:#0000ff">this</span><span class="token punctuation">.</span><span class="token method function property-access" style="color:#795e26">timer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token maybe-class-name">Scratch</span><span class="token punctuation">.</span><span class="token property-access maybe-class-name">Cast</span><span class="token punctuation">.</span><span class="token method function property-access" style="color:#795e26">toNumber</span><span class="token punctuation">(</span><span class="token constant" style="color:#267f99">TIME</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span><span class="token function" style="color:#795e26">timer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#af00db">return</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token known-class-name class-name" style="color:#267f99">Date</span><span class="token punctuation">.</span><span class="token method function property-access" style="color:#795e26">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain"> startTime</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">/</span><span class="token plain"> </span><span class="token number" style="color:#098658">1000</span><span class="token punctuation">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span><span class="token function" style="color:#795e26">resetTimer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    startTime </span><span class="token operator">=</span><span class="token plain"> </span><span class="token known-class-name class-name" style="color:#267f99">Date</span><span class="token punctuation">.</span><span class="token method function property-access" style="color:#795e26">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token maybe-class-name">Scratch</span><span class="token punctuation">.</span><span class="token property-access">extensions</span><span class="token punctuation">.</span><span class="token method function property-access" style="color:#795e26">register</span><span class="token punctuation">(</span><span class="token keyword" style="color:#0000ff">new</span><span class="token plain"> </span><span class="token class-name" style="color:#267f99">TimerReimplementationExample</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#000000"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div>
<p>请注意，我们不必运行 startHats -- Scratch 会自  动在每帧开始时为每个边缘激活的帽子运行 startHats。这允许您在沙盒化扩展中使用边缘激活的帽子。您也不应该为边缘激活的帽子使用 <code>shouldRestartExistingThreads: true</code>。</p>
<p>要测试这个，使用这样的脚本：</p>
<p><img loading="lazy" src="/assets/images/when-timer-gt-say-29b3f360911db7d29b2f84c109195261.svg" width="181" height="196" class="img_ev3q"></p>
<p>打开 JavaScript 控制台，按绿旗，然后等待几秒钟。您会看到类似这样的内容：</p>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#ffffff"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token spread operator">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:#098658">2.719</span><span class="token plain"> </span><span class="token boolean" style="color:#0000ff">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:#098658">2.753</span><span class="token plain"> </span><span class="token boolean" style="color:#0000ff">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:#098658">2.785</span><span class="token plain"> </span><span class="token boolean" style="color:#0000ff">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:#098658">2.818</span><span class="token plain"> </span><span class="token boolean" style="color:#0000ff">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:#098658">2.851</span><span class="token plain"> </span><span class="token boolean" style="color:#0000ff">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:#098658">2.885</span><span class="token plain"> </span><span class="token boolean" style="color:#0000ff">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:#098658">2.918</span><span class="token plain"> </span><span class="token boolean" style="color:#0000ff">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:#098658">2.951</span><span class="token plain"> </span><span class="token boolean" style="color:#0000ff">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:#098658">2.985</span><span class="token plain"> </span><span class="token boolean" style="color:#0000ff">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:#098658">3.017</span><span class="token plain"> </span><span class="token boolean" style="color:#0000ff">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:#098658">4.113</span><span class="token plain"> </span><span class="token boolean" style="color:#0000ff">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:#098658">4.148</span><span class="token plain"> </span><span class="token boolean" style="color:#0000ff">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:#098658">4.181</span><span class="token plain"> </span><span class="token boolean" style="color:#0000ff">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:#098658">4.214</span><span class="token plain"> </span><span class="token boolean" style="color:#0000ff">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:#098658">4.248</span><span class="token plain"> </span><span class="token boolean" style="color:#0000ff">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:#098658">4.281</span><span class="token plain"> </span><span class="token boolean" style="color:#0000ff">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:#098658">4.314</span><span class="token plain"> </span><span class="token boolean" style="color:#0000ff">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:#098658">4.347</span><span class="token plain"> </span><span class="token boolean" style="color:#0000ff">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token number" style="color:#098658">4.381</span><span class="token plain"> </span><span class="token boolean" style="color:#0000ff">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token spread operator">...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>当扩展的计时器达到 3 秒的那一刻，积木块返回 true，脚本开始运行。日志停止 1 秒是因为脚本正在运行。一旦脚本完成，帽子积木块又开始运行。因为它仍然返回 true，脚本不会再次运行，因为条件没有<em>变为真</em>。</p>
<p>与基于谓词的帽子类似，边缘激活的帽子可以接受任意输入，如果需要也可以返回 Promise。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="练习">练习<a href="#练习" class="hash-link" aria-label="Direct link to 练习" title="Direct link to 练习">​</a></h2>
<ol>
<li>创建一个每秒钟运行一次的事件积木块，另一个每 5 秒运行一次，另一个每 10 秒运行一次。</li>
<li>将这三个事件积木块组合成一个带菜单的积木块。</li>
<li>创建一个带文本输入的命令积木块，它将运行普通的 Scratch 广播。内置的&quot;当收到&quot;积木块有完整的 opcode <code>event_whenbroadcastreceived</code>，它的单个参数叫做 <code>BROADCAST_OPTION</code>，这是广播的名称。</li>
<li>修  改上一个练习的广播积木块，使其成为一个返回逗号分隔列表的报告器，该列表包含在新线程启动的每个角色的名称。（提示：<span style="transition:.2s background-color;border-radius:2px;cursor:pointer;background-color:currentcolor"><span style="opacity:0">每个线程对象都包含一个 .target 属性，每个目标对象都有一个 .getName() 方法。</span></span>）</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="下一步">下一步<a href="#下一步" class="hash-link" aria-label="Direct link to 下一步" title="Direct link to 下一步">​</a></h2>
<p>我们已经介绍了许多 API，但<a href="/development/extensions/compatibility">如何确保我们的更改不会破坏项目？</a></p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/Lcyys666/TurboWarpdocs/edit/master/docs/development/extensions/hats.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/development/extensions/assorted-apis"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">各种 API</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/development/extensions/compatibility"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">维护兼容性</div></a></nav></div></div></div></div></main></div></div></div></div>
</body>
</html>